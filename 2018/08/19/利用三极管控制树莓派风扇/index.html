<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 利用三极管控制树莓派风扇 · freeblog</title><meta name="description" content="利用三极管控制树莓派风扇 - Zhang Lei"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="freeblog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/sunchongsheng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">利用三极管控制树莓派风扇</h1><div class="post-info">Aug 19, 2018</div><div class="post-content"><p>由于只要树莓派通电，散热风扇就会不停的转动，不管树莓派是开机还是关机，而且风扇转动的声音很大。因此，通过监控 CPU 的温度去控制风扇的开关是很有必要的。</p>
<a id="more"></a>
<h2 id="配件"><a href="#配件" class="headerlink" title="配件"></a>配件</h2><p>三极管(S8050)、杜邦线、面包板</p>
<h2 id="引脚介绍"><a href="#引脚介绍" class="headerlink" title="引脚介绍"></a>引脚介绍</h2><p><a href="https://www.raspberrypi.org/documentation/usage/gpio-plus-and-raspi2/README.md" target="_blank" rel="noopener">树莓派引脚</a><br>the numbering of the GPIO：<br><img src="https://ws4.sinaimg.cn/large/006tKfTcly1fjlu80fjfij30e7045gmk.jpg" alt=""></p>
<p>physical numbering：<br><img src="https://ws4.sinaimg.cn/large/006tKfTcly1fjlu8c4ilsj30dy03zmy9.jpg" alt=""></p>
<p>三极管(S8050)：<br><img src="https://ws2.sinaimg.cn/large/006tKfTcly1fjlu8yrogcj3075081aar.jpg" alt=""></p>
<blockquote>
<p>集电极接电源正极，发射极接电源负极。</p>
</blockquote>
<p>面包板：<br><img src="https://ws2.sinaimg.cn/large/006tKfTcly1fjlua67zu3j309g0avq40.jpg" alt=""></p>
<blockquote>
<p>+极和-极是两根垂直的导线，标着 50、55、60 这些数字的行，每一行都是一根水平的导线。导线与导线之间互不连接，另外，面包板的左右两半也是互不连接的。面包板相当于导线的作用。</p>
</blockquote>
<h2 id="接线方式"><a href="#接线方式" class="headerlink" title="接线方式"></a>接线方式</h2><p>树莓派 5V 引脚接面包板，同时将风扇红线 接到该导线上；</p>
<p>树莓派 Ground 引脚接到面包板，同时将三极管的E极接到该导线上；</p>
<p>风扇黑线接三极管 C极；</p>
<p>树莓派 GPIO 引脚接到三极管 B极。<br><img src="https://ws2.sinaimg.cn/large/006tKfTcly1fjlubgd9brj31kw16oe81.jpg" alt=""></p>
<h2 id="控制程序-Python"><a href="#控制程序-Python" class="headerlink" title="控制程序(Python)"></a>控制程序(Python)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#-*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> time, datetime</span><br><span class="line"><span class="keyword">import</span> RPi.GPIO <span class="keyword">as</span> GPIO</span><br><span class="line"></span><br><span class="line">GPIO_OUT = <span class="number">18</span></span><br><span class="line">LOG_PATH = <span class="string">'/var/log/fan_control.log'</span></span><br><span class="line">IS_DEBUG=<span class="keyword">False</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_cpu_temperature</span><span class="params">()</span>:</span></span><br><span class="line">  <span class="keyword">with</span> open(<span class="string">"/sys/class/thermal/thermal_zone0/temp"</span>, <span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    temperature = float(f.read()) / <span class="number">1000</span></span><br><span class="line">  log(<span class="string">'DEBUG'</span>, <span class="string">'Current CPU temperature is %s'</span> % temperature)</span><br><span class="line">  <span class="keyword">return</span> temperature</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">start_fan</span><span class="params">()</span>:</span></span><br><span class="line">  log(<span class="string">'INFO'</span>, <span class="string">'power on.'</span>)</span><br><span class="line">  GPIO.output(GPIO_OUT, GPIO.HIGH)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">stop_fan</span><span class="params">()</span>:</span></span><br><span class="line">  log(<span class="string">'INFO'</span>, <span class="string">'power off.'</span>)</span><br><span class="line">  GPIO.output(GPIO_OUT, GPIO.LOW)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setup_GPIO</span><span class="params">()</span>:</span></span><br><span class="line">  GPIO.setmode(GPIO.BCM)</span><br><span class="line">  GPIO.setwarnings(<span class="keyword">False</span>)</span><br><span class="line">  GPIO.setup(GPIO_OUT, GPIO.OUT)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">control_fan</span><span class="params">()</span>:</span></span><br><span class="line">  is_close = <span class="keyword">True</span></span><br><span class="line">  <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">      temp = read_cpu_temperature()</span><br><span class="line">      <span class="keyword">if</span> is_close:</span><br><span class="line">        <span class="keyword">if</span> temp&gt;=<span class="number">53</span>:</span><br><span class="line">          start_fan()</span><br><span class="line">          is_close = <span class="keyword">False</span></span><br><span class="line">      <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> temp&lt;=<span class="number">43</span>:</span><br><span class="line">          stop_fan()</span><br><span class="line">          is_close = <span class="keyword">True</span></span><br><span class="line">      time.sleep(<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">except</span> (KeyboardInterrupt,Exception) <span class="keyword">as</span> e:</span><br><span class="line">      log(<span class="string">'WARN'</span>, e)</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span><span class="params">(level, msg)</span>:</span></span><br><span class="line">  log_msg = <span class="string">'[%s]: %s (%s)'</span> % (level, msg, datetime.datetime.now() )</span><br><span class="line">  <span class="keyword">if</span> IS_DEBUG:</span><br><span class="line">    <span class="keyword">print</span> log_msg</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  <span class="keyword">if</span> level == <span class="string">'DEBUG'</span>:</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  <span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">with</span> open(LOG_PATH, <span class="string">'a'</span>) <span class="keyword">as</span> f:</span><br><span class="line">      f.write(log_msg+<span class="string">'\n'</span>)</span><br><span class="line">  <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"Unable to log, %s"</span> % e</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">  log(<span class="string">'INFO'</span>, <span class="string">'started.'</span>)</span><br><span class="line">  setup_GPIO()</span><br><span class="line">  control_fan()</span><br><span class="line">  GPIO.cleanup()</span><br><span class="line">  log(<span class="string">'INFO'</span>, <span class="string">'quit.'</span>)</span><br></pre></td></tr></table></figure></div></article></div></main><footer><div class="paginator"><a href="/2018/08/19/你好成都/" class="prev">PREV</a><a href="/2018/08/19/在Ubuntu16上搭建shadowsocks/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2018 <a href="http://yoursite.com">Zhang Lei</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>