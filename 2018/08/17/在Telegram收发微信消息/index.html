<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 在 Telegram 收发微信消息 · Lei's blog</title><meta name="description" content="在 Telegram 收发微信消息 - Zhang Lei"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="Lei's blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/leizhang233" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/zhanglei12345" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">在 Telegram 收发微信消息</h1><div class="post-info">Aug 17, 2018</div><div class="post-content"><p>开发代号 <a href="https://github.com/blueset/ehForwarderBot" target="_blank" rel="noopener">EH Forwarder Bot</a>（简称 EFB）是一个可扩展的聊天平台隧道框架，基于 Python 3。目前已内置了 Telegram 主端 (Master Channel) 和微信从端 (Slave Channel)，用来在 Telegram 收发微信消息。</p>
<p>本文介绍了如何在 VPS(Ubuntu 16.04) 中安装并配置 EFB、Telegram 主端和微信从端，以及如何使用 Telegram 主端来收发微信消息。自己用了将近一个月了，体验很棒，尤其是丰富便捷的表情包，可以悄悄告诉你这种方式自带消息防撤回功能，不过需要注意的是这种登录方式是基于网页微信版本的，功能受限制，登录mac版本的微信后也会把其顶掉。</p>
<a id="more"></a>
<h2 id="安装-EFB"><a href="#安装-EFB" class="headerlink" title="安装 EFB"></a>安装 EFB</h2><p>远程登录 VPS，找到合适目录执行以下步骤：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/blueset/ehForwarderBot.git</span><br><span class="line"><span class="built_in">cd</span> ehForwarderBot</span><br><span class="line">mkdir storage</span><br><span class="line">chmod +rw ./storage</span><br></pre></td></tr></table></figure></p>
<p>安装依赖:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install python3-dev python3-setuptools</span><br><span class="line">sudo apt-get install libwebp-dev</span><br><span class="line">sudo apt-get install libmagic-dev ffmpeg</span><br></pre></td></tr></table></figure></p>
<p>安装 python 依赖:<br><code>pip3 install -r requirements.txt</code></p>
<h2 id="创建-Telegram-Bot"><a href="#创建-Telegram-Bot" class="headerlink" title="创建 Telegram Bot"></a>创建 Telegram Bot</h2><p>要创建一个新的 Bot，要先向 @BotFather 发起会话。发送指令 /newbot 以启动向导。期间，你需要指定这个 Bot 的名称与用户名（用户名必须以 bot 结尾）。完毕之后 @BotFather 会提供给你一个密钥（Token）。</p>
<p>接下来还要对刚刚启用的 Bot 进行进一步的配置：允许 Bot 读取非指令信息、允许将 Bot 添加进群组、以及提供指令列表。</p>
<ul>
<li>发送 /setprivacy 到 @BotFather，选择刚刚创建好的 Bot 用户名，然后选择 “Disable”。</li>
<li>发送 /setjoingroups 到 @BotFather，选择刚刚创建好的 Bot 用户名，然后选择 “Enable”。</li>
<li>发送 /setcommands 到 @BotFather，选择刚刚创建好的 Bot 用户名，然后发送如下内容：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">link - 将会话绑定到 Telegram 群组</span><br><span class="line">chat - 生成会话头</span><br><span class="line">recog - 回复语音消息以进行识别</span><br><span class="line">extra - 获取更多功能</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>通过bot获取你自己的 Telegram ID：<br><code>@get_id_bot 发送 /start</code></p>
<h2 id="配置-EFB"><a href="#配置-EFB" class="headerlink" title="配置 EFB"></a>配置 EFB</h2><p>复制并编辑配置文件:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp config.sample.py config.py</span><br><span class="line">vi config.py</span><br></pre></td></tr></table></figure></p>
<p>在配置文件中，token 后引号里面的内容替换为你之前获得的 Bot 密钥，admins 后方括号里面填入你自己的 Telegram ID。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">master_channel = &apos;plugins.eh_telegram_master&apos;, &apos;TelegramChannel&apos;</span><br><span class="line">slave_channels = [(&apos;plugins.eh_wechat_slave&apos;, &apos;WeChatChannel&apos;)]</span><br><span class="line"></span><br><span class="line">eh_telegram_master = &#123;</span><br><span class="line">    &quot;token&quot;: &quot;***:***&quot;,</span><br><span class="line">    &quot;admins&quot;: [***]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="启动-EFB"><a href="#启动-EFB" class="headerlink" title="启动 EFB"></a>启动 EFB</h2><p><code>python3 daemon.py start</code><br>之后可看见二维码，用微信扫描登录即可。</p>
<h2 id="使用-EFB-Telegram-主端"><a href="#使用-EFB-Telegram-主端" class="headerlink" title="使用 EFB Telegram 主端"></a>使用 EFB Telegram 主端</h2><p>现在，在 Telegram 里面搜索你之前指定的 Bot 用户名，点击 Start（开始）即可开始与微信互通消息了。</p>
<p>在最初，所有来自微信的消息都会通过 Bot 直接发送给你，要回复其中的任意一条消息，你需要在 Telegram 中选中那条消息，选择 Reply（回复），再输入消息内容。</p>
<p>如果需要向新联系人发送消息，只需发送 /chat 指令，选择一个会话。之后这条消息就会变成一个「会话头」，回复这条消息就可以向指定的联系人或群组发送消息。</p>
<p>当消息过多时，来自不同会话的消息会使 Telegram 上面的会话混乱不堪。EFB 支持将来自指定会话的消息分流到一个 Telegram 群组中。</p>
<ul>
<li>在 Telegram 中新建一个空群组，并将你的 Bot 加入到这个群组中。</li>
<li>回到 Bot 会话，发送 /link，选择一个会话，并点击 “Link”。</li>
<li>在弹出的列表中选择刚刚创建的空群组即可。</li>
</ul>
<p>利用这种方式可以实现等同于微信里面的一对一对话。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2018/08/19/入手折腾SamsungChromebookPro/" class="prev">PREV</a><a href="/2018/08/16/TelegramBot初体验/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'https-zhanglei12345-github-io';
var disqus_identifier = '2018/08/17/在Telegram收发微信消息/';
var disqus_title = '在 Telegram 收发微信消息';
var disqus_url = 'http://yoursite.com/2018/08/17/在Telegram收发微信消息/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//https-zhanglei12345-github-io.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2018 <a href="http://yoursite.com">Zhang Lei</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>